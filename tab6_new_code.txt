with tabs[5]:  # Tab 6 - Unlearning
    st.header("🗑️ Machine Unlearning (GDPR/HIPAA Compliance)")
    st.markdown("*Remove specific patient cases and retrain affected model shards*")
    
    if 'trained_model' not in st.session_state:
        st.warning("⚠️ No trained SISA model found. Please train a model in Tab 2 first.")
    else:
        st.info(f"📊 Current model: {st.session_state.trained_model.n_shards} shards trained")
        
        case_id_input = st.text_input(
            "Enter Case ID to Remove:",
            placeholder="e.g., 12345678",
            help="Enter the primary ID of the case to remove from the system"
        )
        
        if st.button("🗑️ Unlearn Case", type="primary", use_container_width=True):
            if not case_id_input:
                st.error("❌ Please enter a valid Case ID")
            else:
                try:
                    case_id = int(case_id_input)
                    
                    progress_bar = st.progress(0.0)
                    status_text = st.empty()
                    
                    def update_progress(progress, message):
                        progress_bar.progress(progress)
                        status_text.info(f"🔄 {message}")
                    
                    with st.spinner("Processing unlearning request..."):
                        result = st.session_state.trained_model.unlearn(
                            case_id, 
                            progress_callback=update_progress
                        )
                    
                    progress_bar.progress(1.0)
                    status_text.success("✅ Unlearning complete!")
                    
                    if result['success']:
                        st.success(f"✅ **Unlearning Successful**")
                        st.markdown(f"""
                        - **Case ID:** {case_id}
                        - **Shard:** {result.get('shard_id', 'N/A')}
                        - **Cases Removed:** {result.get('cases_removed', 1)}
                        - **Retraining Time:** {result.get('retrain_time', 'N/A'):.2f}s
                        """)
                    else:
                        st.error(f"❌ Unlearning failed: {result.get('message', 'Unknown error')}")
                        
                except ValueError:
                    st.error("❌ Case ID must be a valid number")
                except Exception as e:
                    st.error(f"❌ Error during unlearning: {str(e)}")
                    progress_bar.empty()
                    status_text.empty()
