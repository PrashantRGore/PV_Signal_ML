REPLACE TAB 6 (UNLEARNING) IN app_enhanced.py WITH THIS:

# ========== TAB 6: UNLEARNING (WITH PROGRESS) ==========
with tab6:
    st.header('Machine Unlearning (GDPR Right to be Forgotten)')
    
    st.markdown('''
    **SISA Unlearning Process:**
    1. 🔍 Identify case in training data
    2. 📊 Log unlearning event to MLflow
    3. 🗑️ Remove case from affected shard
    4. 🔄 Retrain only affected shard
    5. 📋 Log updated model to MLflow
    6. ✅ Update ensemble without full retraining
    ''')
    
    if st.session_state.trained_model is not None:
        st.subheader('Current Model Status')
        col1, col2, col3 = st.columns(3)
        with col1:
            st.metric('Model Version', '1.0')
        with col2:
            if hasattr(st.session_state.trained_model, 'shard_models'):
                st.metric('Active Shards', len(st.session_state.trained_model.shard_models))
        with col3:
            if hasattr(st.session_state.trained_model, 'shard_assignments'):
                st.metric('Tracked Cases', len(st.session_state.trained_model.shard_assignments))
        
        st.markdown('---')
        st.subheader('Unlearn Case')
        
        # Show available case IDs (first 10)
        if hasattr(st.session_state.trained_model, 'shard_assignments'):
            with st.expander('📋 View Sample Case IDs'):
                sample_ids = list(st.session_state.trained_model.shard_assignments.keys())[:10]
                for i, case_id in enumerate(sample_ids, 1):
                    shard = st.session_state.trained_model.shard_assignments[case_id]
                    st.text(f'{i}. {case_id} (Shard {shard})')
                if len(st.session_state.trained_model.shard_assignments) > 10:
                    st.info(f'... and {len(st.session_state.trained_model.shard_assignments) - 10} more cases')
        
        case_id = st.text_input('Enter Case ID to Unlearn', 
                                help='Format: DrugName_EventName')
        
        unlearn_reason = st.selectbox('Reason for Unlearning',
            ['GDPR Right to be Forgotten Request',
             'HIPAA Data Deletion Request',
             'Patient Withdrawal of Consent',
             'Data Quality Issue',
             'Regulatory Requirement',
             'Other'])
        
        if st.button('🗑️ Unlearn Case', type='primary'):
            if case_id:
                # Create progress tracking UI
                progress_bar = st.progress(0.0)
                status_text = st.empty()
                
                def update_progress(progress, message):
                    progress_bar.progress(progress)
                    status_text.info(message)
                
                # Execute unlearning with progress
                result = st.session_state.trained_model.unlearn(
                    case_id, 
                    progress_callback=update_progress
                )
                
                if result['status'] == 'unlearned':
                    st.success(f'✅ Case {case_id} successfully unlearned!')
                    
                    # Show detailed results
                    col1, col2, col3 = st.columns(3)
                    with col1:
                        st.metric('Affected Shard', result['affected_shard'])
                    with col2:
                        st.metric('Original Size', result['original_shard_size'])
                    with col3:
                        st.metric('New Size', result['new_shard_size'])
                    
                    # Show MLflow link
                    st.info(f'📊 MLflow Run ID: {result["mlflow_run_id"]}')
                    st.markdown(f'[View in MLflow UI](http://localhost:5000)')
                    
                    # Detailed result
                    with st.expander('📋 Detailed Unlearning Report'):
                        st.json(result)
                    
                elif result['status'] == 'not_found':
                    st.warning(f'⚠️ Case {case_id} not found in training data')
                    st.info('**Possible reasons:**')
                    st.info('- Case ID not in training set (might be in test set)')
                    st.info('- Typo in case ID')
                    st.info('- Case already unlearned')
                    
                else:
                    st.error(f'❌ Unlearning failed: {result.get("error", "Unknown error")}')
            else:
                st.error('Please enter a case ID')
        
        # Unlearning history (from MLflow)
        st.markdown('---')
        st.subheader('📜 Unlearning History')
        
        try:
            mlflow.set_tracking_uri(config.MLFLOW_TRACKING_URI)
            experiments = mlflow.search_experiments()
            unlearn_exp = [e for e in experiments if 'Data_Unlearning' in e.name]
            
            if unlearn_exp:
                runs = mlflow.search_runs(experiment_ids=[unlearn_exp[0].experiment_id])
                
                if not runs.empty:
                    st.dataframe(
                        runs[['run_id', 'start_time', 'params.case_id', 'params.affected_shard']].head(10),
                        use_container_width=True
                    )
                else:
                    st.info('No unlearning events yet')
            else:
                st.info('No unlearning events yet')
        except Exception as e:
            st.warning(f'Could not load unlearning history: {str(e)}')
    else:
        st.warning('⚠️ Train SISA model first (Tab 2)')
